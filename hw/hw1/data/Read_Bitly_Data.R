rm(list=ls())
setwd("/home/bst/faculty/jleek/teaching/bitly")

library(RJSONIO)
username <- Sys.info()["user"]
f <- file("biostats_encode_data.txt")
x <- readLines(f)
close(f)
x[1] <- paste0("[", x[1])
x[length(x)] <- paste0(x[length(x)], "]")
x <- paste(x, collapse=", ")
df <- fromJSON(x)
rm(list="x")
cn <- lapply(df, names)
unames <- unique(unlist(cn))
test <- sapply(cn, function(x) all(x== unames))
if (!all(test)) stop("names are not the same, can't cbind")
df2 <- do.call("rbind", df)
encode <- as.data.frame(df2, stringsAsFactors=FALSE)
rm(list=c("df", "df2", "test"))
save(encode, file=file.path("/home/bst/student", username, "Bitly_Encode.Rda"))


rm(list=c("encode"))

f <- file("biostats_decode_data.txt")
x <- readLines(f)
close(f)
x[1] <- paste0("[", x[1])
x[length(x)] <- paste0(x[length(x)], "]")
x <- paste(x, collapse=", ")
df <- fromJSON(x)
rm(list="x")
cn <- lapply(df, names)
unames <- unique(unlist(cn))
test <- sapply(cn, function(x) all(x== unames))
if (!all(test)) stop("names are not the same, can't cbind")
df2 <- do.call("rbind", df)
decode <- as.data.frame(df2, stringsAsFactors=FALSE)
rm(list=c("df", "df2", "test"))
save(decode, file=file.path("/home/bst/student", username, "Bitly_Decode.Rda"))

